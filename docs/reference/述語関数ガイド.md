# 述語関数ガイド（Predicates: `is_*`）

本ガイドは FortLearner の述語関数（`is_*`）の整理です。述語は「性質が成り立つか」を純粋関数で判定し、他レイヤ（check/warn）に再利用されます。

## 方針
- すべて原則 `pure elemental`。副作用なし、配列にも要素ごとに適用可能。
- NaN/Inf は常に「望ましくない」→ `.false.` を返す。
- 浮動小数の同値判定は `is_close(x, y, atol, rtol)` を用意（既定: `ATOL_R64=1e-10`, `RTOL_R64=1e-6`）。

## 主なモジュールと役割
- `mod_is_close` … 近似等価判定（`atol/rtol`）
- `mod_is_finite` … 有限値判定（NaN/Inf を除外）
- `mod_is_positive_sized_array` … 配列サイズが正（ゼロ超）
- `mod_is_allowed_option` … 文字列オプションが許可集合に含まれるか
- `mod_is_sign` … 符号判定（正/負/非負など）
- `mod_is_in_range` … 範囲包含（[lo, hi] を想定）
- `mod_predicates` … 上記の薄い束ね・エイリアス

## 使用例（概念）
```fortran
pure elemental logical function is_in_range_r64(x, lo, hi)
  real(r64), intent(in) :: x, lo, hi
  is_in_range_r64 = (x >= lo) .and. (x <= hi)
end
```

## 設計ノート
- 述語は「肯定形・単一概念」の命名に統一（例: `is_non_negative_r64`）。
- 比較略語は対称: `ge/gt/le/lt`、対象は `rows/cols/size/value` などを明示。

## 関数一覧（簡易シグネチャ）

- mod_is_close
  - `is_close(x: r64, y: r64, rtol?: r64, atol?: r64) -> logical`
  - `is_zero(x: r64, atol?: r64) -> logical`
  - `is_one(x: r64, rtol?: r64, atol?: r64) -> logical`
- mod_is_finite
  - `is_finite(x: r64) -> logical`
  - `is_all_finite(vec: r64(:)) -> logical`
  - `is_all_finite(mat: r64(:,:)) -> logical`
- mod_is_in_range
  - `is_in_range_i64(x: i64, lo: i64, hi: i64) -> logical`
  - `is_in_range_r64(x: r64, lo: r64, hi: r64) -> logical`
- mod_is_sign
  - `is_positive_{i64,r64}(x) -> logical`
  - `is_negative_{i64,r64}(x) -> logical`
  - `is_non_positive_{i64,r64}(x) -> logical`
  - `is_non_negative_{i64,r64}(x) -> logical`
- mod_is_allowed_option
  - `is_allowed_option_i64(target: i64, allowed: i64(:)) -> logical`
  - `is_allowed_option_character(target: char(*), allowed: char(*)(:)) -> logical`
- mod_is_positive_sized_array
  - `is_positive_sized_vector_{r64,i64}(vec(:)) -> logical`
  - `is_positive_sized_matrix_{r64,i64}(mat(:,:)) -> logical`

## 実装ファイル（モジュール → パス）

- `mod_is_close` → `fortlearner/utils/predicates/mod_is_close.f90`
- `mod_is_finite` → `fortlearner/utils/predicates/mod_is_finite.f90`
- `mod_is_in_range` → `fortlearner/utils/predicates/mod_is_in_range.f90`
- `mod_is_allowed_option` → `fortlearner/utils/predicates/mod_is_allowed_option.f90`
- `mod_is_sign` → `fortlearner/utils/predicates/mod_is_sign.f90`
- `mod_is_positive_sized_array` → `fortlearner/utils/predicates/mod_is_positive_sized_array.f90`
- `mod_predicates` → `fortlearner/utils/predicates/mod_predicates.f90`
