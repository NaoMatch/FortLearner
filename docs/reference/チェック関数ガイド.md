# チェック関数ガイド（Checks: `check_*`）

`check_*` は条件が満たされない場合に一貫したメッセージを出力し、`error stop` します。設計上、Python 側の軽量検証の後、Fortran 側が単一のソース・オブ・トゥルースとして最終チェックを行います。

## メッセージとエラーコード
- 形式: `[file:class/value] must be <条件>, but got <実際値>.`
- エラーコード: `ERR_` + 状態名（例: `ERR_NON_FINITE`, `ERR_TOO_FEW_ROWS`, `ERR_RELATION`）
- 実装: `fortlearner/utils/check/mod_error_codes.f90`, `mod_error_manager.f90`

## 主なカテゴリとモジュール
- 値の性質
  - `mod_check_positive.*`, `mod_check_non_positive.*`
  - `mod_check_negative.*`, `mod_check_non_negative.*`
  - `mod_check_finite.*`
- 範囲・関係
  - `mod_check_in_range.*`, `mod_check_relation.*`（`ge/gt/le/lt/eq`）
  - `mod_check_allowed_option.*`（文字列オプション）
- 形状・サイズ
  - `mod_check_array_shape.*`, `mod_check_rows_distinct.*`
- 状態・I/O
  - `mod_check_fitted_model.*`（学習済み判定）
  - `mod_check_format_version.*`, `mod_check_file_exists.*`
- 束ね
  - `mod_check.f90`（共通ユーティリティ）

## 使用例（概念）
```fortran
subroutine check_positive_i64(x, file, class_name, value_name)
  if (.not. is_positive_i64(x)) then
    ! 例外情報を構築して error stop
    error stop ERR_NON_POSITIVE_VALUE
  end if
end
```

## 設計ノート
- API は肯定形・単一概念で統一。対象（rows/cols/size/value）を明示。
- 比較系では `ERR_RELATION` を共通利用しつつ、必要に応じ詳細コードを追加。

## 関数一覧（簡易シグネチャ）

- mod_check_positive
  - `check_positive_r64(a: r64, file, class_name, value_name, fatal?)`
  - `check_positive_i64(a: i64, file, class_name, value_name, fatal?)`
- mod_check_in_range
  - `check_in_range_i64(a: i64, lo?: i64, hi?: i64, file, class_name, value_name, fatal?)`
  - `check_greater_equal_i64(a: i64, lo: i64, file, class_name, value_name, fatal?)`
  - `check_less_equal_i64(a: i64, hi: i64, file, class_name, value_name, fatal?)`
- mod_check_array_shape
  - `check_min_rows_{r64,i64}(a(:,:), min_rows: i64, file, class_name, value_name, fatal?)`
  - `check_min_cols_{r64,i64}(a(:,:), min_cols: i64, file, class_name, value_name, fatal?)`
  - `check_exact_shape_{r64,i64}(a(:,:), exp_rows: i64, exp_cols: i64, file, class_name, value_name, fatal?)`
- その他の代表
  - `mod_check_finite` … 要素の有限性
  - `mod_check_rows_distinct` … 行の重複チェック
  - `mod_check_allowed_option` … 文字列オプションの許容集合チェック
  - `mod_check_relation` … ge/gt/le/lt 等の関係チェック
  - `mod_check_file_exists`, `mod_check_format_version` … I/O/フォーマットの整合チェック
  - `mod_check_fitted_model` … 学習済み状態の検証

## 実装ファイル（モジュール → パス）

- 値・範囲・形状
  - `mod_check_positive` → `fortlearner/utils/check/mod_check_positive.f90`
  - `mod_check_non_positive` → `fortlearner/utils/check/mod_check_non_positive.f90`
  - `mod_check_negative` → `fortlearner/utils/check/mod_check_negative.f90`
  - `mod_check_non_negative` → `fortlearner/utils/check/mod_check_non_negative.f90`
  - `mod_check_in_range` → `fortlearner/utils/check/mod_check_in_range.f90`
  - `mod_check_relation` → `fortlearner/utils/check/mod_check_relation.f90`
  - `mod_check_array_shape` → `fortlearner/utils/check/mod_check_array_shape.f90`
  - `mod_check_rows_distinct` → `fortlearner/utils/check/mod_check_rows_distinct.f90`
- I/O・フォーマット・状態
  - `mod_check_finite` → `fortlearner/utils/check/mod_check_finite.f90`
  - `mod_check_file_exists` → `fortlearner/utils/check/mod_check_file_exists.f90`
  - `mod_check_format_version` → `fortlearner/utils/check/mod_check_format_version.f90`
  - `mod_check_fitted_model` → `fortlearner/utils/check/mod_check_fitted_model.f90`
  - `mod_check_allowed_option` → `fortlearner/utils/check/mod_check_allowed_option.f90`
- 束ね/基盤
  - `mod_check` → `fortlearner/utils/check/mod_check.f90`
  - `mod_error_codes` → `fortlearner/utils/check/mod_error_codes.f90`
  - `mod_error_manager` → `fortlearner/utils/check/mod_error_manager.f90`
  - `mod_error_bindings` → `fortlearner/utils/check/bindings/mod_error_bindings.f90`
